let toEvaluate="",isHistoryOpen=!1;const keys="0123456789()/x-+.".split(""),previousCalculation=document.querySelector("._previous-calculation"),result=document.querySelector("._calculation"),buttons=document.querySelectorAll(".__buttons span"),historyButton=document.querySelector("._history-icon"),historyContainer=document.querySelector("._history-items");function calculate(){let clickedText=this.innerText;if("x"==clickedText&&(clickedText="*"),"AC"==clickedText){toEvaluate="",result.innerText="",maxLength();return}if("delete"==this.dataset.button){(""==result.innerText||"Error"==result.innerText||"Infinity"==result.innerText||"undefined"==result.innerText)&&(toEvaluate="",result.innerText=""),toEvaluate=toEvaluate.slice(0,-1),result.innerText=result.innerText.slice(0,-1),maxLength();return}if("="==clickedText){try{if(""==result.innerText)return;previousCalculation.innerText=`${result.innerText}`,null!==document.querySelector(".empty_")&&document.querySelector(".empty_").remove(),historyContainer.innerHTML+=`<span>${result.innerText}=${eval(toEvaluate)}</span>`,toEvaluate=`${eval(toEvaluate)}`,result.innerText=toEvaluate}catch{result.innerText="Error"}maxLength();return}"Error"==result.innerText||"Infinity"==result.innerText||"undefined"==result.innerText?(toEvaluate="",toEvaluate+=clickedText,result.innerText="",result.innerText+=clickedText):(result.innerText+=clickedText,toEvaluate+=clickedText),maxLength()}function maxLength(){result.innerText.length>=20?buttons.forEach(e=>{"AC"==e.innerText||"delete"==e.dataset.button||"="==e.innerText?e.addEventListener("click",calculate):e.removeEventListener("click",calculate)}):buttons.forEach(e=>e.addEventListener("click",calculate))}function history(){isHistoryOpen?(historyContainer.style.display="none",historyButton.dataset.historyOpened="false",isHistoryOpen=!1):(""==historyContainer.innerText&&(historyContainer.innerHTML='<span class="empty_">Empty.</span>'),historyContainer.style.display="block",historyButton.dataset.historyOpened="true",isHistoryOpen=!0)}buttons.forEach(e=>e.addEventListener("click",calculate)),historyButton.addEventListener("click",history),document.addEventListener("keydown",e=>{switch(keys.forEach((t,n)=>{e.key==t.toLowerCase()&&buttons.forEach(t=>{t.innerText.includes(e.key)&&t.click()})}),e.key){case"End":buttons[0].click();break;case"Backspace":case"Delete":buttons[1].click();break;case"*":buttons[11].click();break;case"=":case"Enter":buttons[18].click()}});